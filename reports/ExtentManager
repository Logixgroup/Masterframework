package com.can.reports;

import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.ExtentReports;
import java.util.Objects;

public final class  {

    private ExtentManager() {} // prevent object creation

    private static ThreadLocal<ExtentTest> extTest = new ThreadLocal<>();

    /* ─────────────────────────────── CORE METHODS ─────────────────────────────── */

    /** Set test instance in thread local */
    static void setExtentTest(ExtentTest test) {
        extTest.set(test);
    }

    /** Get current test instance */
    public static ExtentTest getExtentTest() {
        return extTest.get();
    }

    /** Removes test instance when test ends (prevents memory leak in parallel runs) */
    static void unload() {
        extTest.remove();
    }

    /* ─────────────────────────────── UTILITY METHODS ─────────────────────────────── */

    /**
     * Create a new ExtentTest and store via ThreadLocal.
     * (Listener will call this for every @Test method)
     */
    public static ExtentTest createTest(String testName) {
        ExtentTest test = ExtentReportNG.getExtent().createTest(testName);
        setExtentTest(test);
        return test;
    }

    /**
     * Create a test with description.
     */
    public static ExtentTest createTest(String testName, String description) {
        ExtentTest test = ExtentReportNG.getExtent().createTest(testName, description);
        setExtentTest(test);
        return test;
    }

    /** Add category to report (ex: Regression / Smoke / API / UI) */
    public static void assignCategory(String... categories) {
        if (Objects.nonNull(getExtentTest())) {
            getExtentTest().assignCategory(categories);
        }
    }

    /** Add author info (ex: automation engineer) */
    public static void assignAuthor(String... authors) {
        if (Objects.nonNull(getExtentTest())) {
            getExtentTest().assignAuthor(authors);
        }
    }

    /** Add device info (Chrome, Firefox, Mobile etc.) */
    public static void assignDevice(String... devices) {
        if (Objects.nonNull(getExtentTest())) {
            getExtentTest().assignDevice(devices);
        }
    }

public static void addCategory(String category) {
        if (getExtentTest() != null)
            getExtentTest().assignCategory(category);
    }

    /**
     * Highlight log for better visibility in reports
     */
    public static void logInfoHighlighted(String message) {
        if (getExtentTest() != null)
            getExtentTest().info(MarkupHelper.createLabel(message, ExtentColor.BLUE));
    }

    /**
     * Log warning in yellow color
     */
    public static void logWarning(String message) {
        if (getExtentTest() != null)
            getExtentTest().warning(MarkupHelper.createLabel(message, ExtentColor.ORANGE));
    }

    /**
     * Create a child node under same test (useful for step logging)
     */
    public static ExtentTest createNode(String nodeName) {
        if (getExtentTest() != null)
            return getExtentTest().createNode(nodeName);
        return null;
    }

    /**
     * Safely print log without breaking report (even if extentTest is null)
     */
    public static void safeLog(String message) {
        if (getExtentTest() != null)
            getExtentTest().info(message);
    }

}
